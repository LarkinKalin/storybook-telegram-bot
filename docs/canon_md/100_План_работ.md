# 100 ‚Äî –ü–ª–∞–Ω —Ä–∞–±–æ—Ç
–ò—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã: 100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç.docx
SKAZKA-TG-PLAN-100 v0.2 ‚Äî –ø–ª–∞–Ω —Å –æ—Ç–º–µ—Ç–∫–∞–º–∏ —Ñ–∞–∫—Ç–∞ (–ø–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è)
ID: SKAZKA-TG-PLAN-100
–í–µ—Ä—Å–∏—è: v0.2
–°—Ç–∞—Ç—É—Å: DRAFT
–î–∞—Ç–∞: 2026-01-16
–í–ª–∞–¥–µ–ª–µ—Ü: –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
–õ–µ–≥–µ–Ω–¥–∞: ‚úÖ ACCEPTED / üü° PARTIAL / ‚è≥ BACKLOG
________________________________________
0. –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ –≤—Å–µ–º —ç—Ç–∞–ø–∞–º) ‚úÖ (–≤ —Å–∏–ª–µ)
0.1. –†–µ–¥–∞–∫—Ç–æ—Ä ‚úÖ
‚Ä¢ –ü—Ä–∞–≤–∫–∏ –¥–µ–ª–∞–µ–º —á–µ—Ä–µ–∑ nano (Ubuntu). 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
0.2. –†–∞–∑–≤–µ–¥–∫–∞ –ø–µ—Ä–µ–¥ –ø—Ä–∞–≤–∫–æ–π (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è) ‚úÖ
–ü–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ–∞–π–ª–∞ –≤—ã–ø–æ–ª–Ω—è–µ–º –º–∏–Ω–∏–º—É–º:
‚Ä¢ pwd, ls
‚Ä¢ git status (–µ—Å–ª–∏ —ç—Ç–æ —Ä–µ–ø–æ)
‚Ä¢ –ø–æ–Ω—è—Ç—å ‚Äú—á—Ç–æ —ç—Ç–æ –∑–∞ —Ñ–∞–π–ª‚Äù:
o ls -la <file>
o sed -n '1,120p <file>'
‚Ä¢ –Ω–∞–π—Ç–∏ —Ç–æ—á–∫—É –ø—Ä–∞–≤–∫–∏:
o grep -n "<pattern>" <file> 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
0.3. –ë—ç–∫–∞–ø –ø–µ—Ä–µ–¥ –ø—Ä–∞–≤–∫–æ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ–∞–π–ª–∞ ‚úÖ
‚Ä¢ –ø–∞–ø–∫–∞: /srv/git/skazka/backups/
‚Ä¢ —Ñ–æ—Ä–º–∞—Ç: backups/YYYYMMDD_HHMM_<–∏–º—è—Ñ–∞–π–ª–∞>.bak
‚Ä¢ –∫–æ–º–∞–Ω–¥–∞-—à–∞–±–ª–æ–Ω:
cp -a <file> /srv/git/skazka/backups/$(date +%Y%m%d_%H%M)_$(basename <file>).bak 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
0.4. –ú–∞–ª–µ–Ω—å–∫–∏–µ —à–∞–≥–∏ ‚úÖ
‚Ä¢ 1‚Äì3 –∏–∑–º–µ–Ω–µ–Ω–∏—è ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ ‚Üí —Ñ–∏–∫—Å–∞—Ü–∏—è.
‚Ä¢ –ï—Å–ª–∏ —à–∞–≥ ‚Äú–Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–π‚Äù, –∑–Ω–∞—á–∏—Ç —à–∞–≥ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π. 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
0.5. –ü—Ä–∞–≤–∏–ª–æ –≤—ã–¥–∞—á–∏ –∫–æ–¥–∞ –∏ –ø—Ä–∞–≤–æ–∫ ‚úÖ
‚Ä¢ –Ω–æ–≤—ã–π —Ñ–∞–π–ª/–ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–ø–∏—Å—å ‚Üí –≤—ã–¥–∞—ë–º –≤–µ—Å—å —Ñ–∞–π–ª —Ü–µ–ª–∏–∫–æ–º
‚Ä¢ –º–∏–∫—Ä–æ-–ø—Ä–∞–≤–∫–∞ ‚Üí —Å—Ç—Ä–æ–≥–æ: –ø—É—Ç—å ‚Üí —á—Ç–æ —É–¥–∞–ª–∏—Ç—å ‚Üí —á—Ç–æ –≤—Å—Ç–∞–≤–∏—Ç—å ‚Üí –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
‚Ä¢ –∫–æ–≥–¥–∞ –≥–æ–≤–æ—Ä–∏–º ‚Äú–ø—Ä–∞–≤—å —Ñ–∞–π–ª‚Äù –≤—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–Ω—ã–π –ø—É—Ç—å (–ø—Ä–∏–º–µ—Ä: /srv/git/skazka/...) 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
0.6. Git-—Ä–∏—Ç—É–∞–ª (—á—Ç–æ–±—ã GitHub –∏–º–µ–ª —Å–º—ã—Å–ª) ‚úÖ
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–≥–æ –º–∏–Ω–∏-—à–∞–≥–∞:
‚Ä¢ git status
‚Ä¢ git add <files>
‚Ä¢ git commit -m "feat/fix/chore: <–∫–æ—Ä–æ—Ç–∫–æ>"
‚Ä¢ git push (–µ—Å–ª–∏ –µ—Å—Ç—å —Å–µ—Ç—å/–¥–æ—Å—Ç—É–ø) 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
0.7. –§–∏–∫—Å–∞—Ü–∏—è —Ñ–∞–∫—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è ‚úÖ
–ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –∫–≤–µ—Å—Ç–∞ –¥–µ–ª–∞–µ–º –∑–∞–ø–∏—Å—å –≤ –∂—É—Ä–Ω–∞–ª —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (/srv/git/skazka/reports/...). 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
________________________________________
1. –≠—Ç–∞–ø 0: –°–µ—Ä–≤–µ—Ä, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, GitHub, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è ‚úÖ (–≠–¢–ê–ü –ó–ê–ö–†–´–¢)
–¶–µ–ª—å: –µ—Å—Ç—å —Ä–∞–±–æ—á–∞—è –ø–ª–æ—â–∞–¥–∫–∞ –∏ –ø–æ–Ω—è—Ç–Ω–æ–µ –¥–µ—Ä–µ–≤–æ. –ù–∏–∫–∞–∫–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ ‚Äú–≤ –≤–æ–∑–¥—É—Ö–µ‚Äù. 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
1.1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—É—Ç–µ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–≤–Ω–µ —Ä–µ–ø–æ) ‚úÖ ACCEPTED
–°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:
‚Ä¢ /etc/skazka/
‚Ä¢ /var/lib/skazka/
‚Ä¢ /var/log/skazka/
‚Ä¢ /var/backups/skazka/ 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
1.2. –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ ‚úÖ ACCEPTED
‚Ä¢ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞: /srv/git/skazka/
‚Ä¢ —Å–æ–∑–¥–∞—Ç—å –¥–µ—Ä–µ–≤–æ —Ä–µ–ø–æ (–º–∏–Ω–∏–º—É–º):
o /srv/git/skazka/apps/tg-bot/
o /srv/git/skazka/packages/engine/
o /srv/git/skazka/packages/llm/
o /srv/git/skazka/packages/filters/
o /srv/git/skazka/packages/payments-ton/
o /srv/git/skazka/packages/db/
o /srv/git/skazka/infra/
o /srv/git/skazka/scripts/
o /srv/git/skazka/tests/
o /srv/git/skazka/backups/
o /srv/git/skazka/reports/ 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
1.3. –í—ã–±–æ—Ä —Å—Ç–µ–∫–∞ (—Ñ–∏–∫—Å–∏—Ä—É–µ–º –æ–¥–∏–Ω –¥–ª—è MVP) ‚úÖ ACCEPTED
–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –¥–µ—Ñ–æ–ª—Ç (MVP): Python 3.11 + aiogram + Postgres. 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
1.4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è git –∏ –ø—Ä–∞–≤–∏–ª–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤ ‚úÖ ACCEPTED
‚Ä¢ —Å–æ–∑–¥–∞—Ç—å /srv/git/skazka/.gitignore (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
‚Ä¢ –∑–∞–ø—Ä–µ—Ç: —Å–µ–∫—Ä–µ—Ç—ã –Ω–µ –≤ —Ä–µ–ø–æ (BOT_TOKEN/LLM_KEY/DB_URL/TON_KEY)
‚Ä¢ —Å–æ–∑–¥–∞—Ç—å /srv/git/skazka/infra/env.example (–±–µ–∑ –∫–ª—é—á–µ–π)
‚Ä¢ —Å–µ–∫—Ä–µ—Ç—ã –¥–µ—Ä–∂–∞—Ç—å –≤ /etc/skazka/skazka.env 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
1.5. GitHub ‚úÖ ACCEPTED
‚Ä¢ —Å–æ–∑–¥–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub (public/private)
‚Ä¢ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å SSH –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
‚Ä¢ –¥–æ–±–∞–≤–∏—Ç—å remote origin
‚Ä¢ —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–≤—ã–π commit –∏ push 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
1.6. –ñ—É—Ä–Ω–∞–ª—ã —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ ‚úÖ ACCEPTED
–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª—ã:
‚Ä¢ /srv/git/skazka/reports/IMPLEMENTATION_INDEX.md
‚Ä¢ /srv/git/skazka/reports/TG_BOT.md
‚Ä¢ /srv/git/skazka/reports/ENGINE.md
‚Ä¢ /srv/git/skazka/reports/LLM_FILTERS.md
‚Ä¢ /srv/git/skazka/reports/OPS_DB_TON.md 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
1.7. Dev-–∏–Ω—Ñ—Ä–∞ (ChatGPT GitHub Connector / Codex / VS Code Remote SSH) ‚úÖ (–≠–¢–ê–ü –ó–ê–ö–†–´–¢)
‚Ä¢ TG.0.7.01 ‚Äî GitHub Connector –≤ ChatGPT (Only select repositories: LarkinKalin/storybook-telegram-bot) ‚úÖ DONE
‚Ä¢ TG.0.7.02 ‚Äî Codex –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é –∏ –≤–∏–¥–∏—Ç –¥–µ—Ä–µ–≤–æ/—Ñ–∞–π–ª—ã ‚úÖ DONE
‚Ä¢ TG.0.7.03 ‚Äî VS Code Remote-SSH –Ω–∞—Å—Ç—Ä–æ–µ–Ω, workspace /srv/git/skazka –æ—Ç–∫—Ä—ã—Ç ‚úÖ DONE
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
DoD —ç—Ç–∞–ø–∞ 0 ‚úÖ
‚Ä¢ –ø—É—Ç–∏ –≤–Ω–µ —Ä–µ–ø–æ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
‚Ä¢ –¥–µ—Ä–µ–≤–æ —Ä–µ–ø–æ —Å–æ–∑–¥–∞–Ω–æ
‚Ä¢ git —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–µ—Ä–≤—ã–π push –Ω–∞ GitHub —Å–¥–µ–ª–∞–Ω
‚Ä¢ reports/ —Å–æ–∑–¥–∞–Ω, —Ñ–∞–π–ª—ã –∂—É—Ä–Ω–∞–ª–æ–≤ –µ—Å—Ç—å
‚Ä¢ —Å–µ–∫—Ä–µ—Ç—ã –Ω–µ –ø–æ–ø–∞–ª–∏ –≤ git 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
–ü—Ä–æ–≤–µ—Ä–∫–∞
‚Ä¢ ls -la /srv/git/skazka
‚Ä¢ git -C /srv/git/skazka status
‚Ä¢ git -C /srv/git/skazka log --oneline -n 5 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
________________________________________
2. –≠—Ç–∞–ø 1: –ö–æ–Ω—Ç–µ–Ω—Ç –∫–∞–∫ –¥–∞–Ω–Ω—ã–µ (—Ç–µ–º—ã) + UX-—Å–∫–µ–ª–µ—Ç TG-–±–æ—Ç–∞ (–∑–∞–≥–ª—É—à–∫–∏) üü° (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ)
–¶–µ–ª—å: –±–æ—Ç ‚Äú–æ—â—É—â–∞–µ—Ç—Å—è‚Äù, –∞ —Ç–µ–º—ã –Ω–µ –∑–∞—à–∏—Ç—ã –≤ –∫–æ–¥–µ —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤. 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
2.1. –¢–µ–º—ã (–∫–∞–∫ –¥–∞–Ω–Ω—ã–µ, –∞ –Ω–µ —Ö–∞—Ä–¥–∫–æ–¥) ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
‚Ä¢ –∑–∞–≤–µ—Å—Ç–∏ —Ñ–∞–π–ª —Ç–µ–º –≤ —Ä–µ–ø–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä:
o /srv/git/skazka/packages/content/themes_ru.json (–µ—Å–ª–∏ –≤—ã–¥–µ–ª–∏—à—å content-–ø–∞–∫–µ—Ç –ø–æ–∑–∂–µ)
–∏–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ:
o /srv/git/skazka/apps/tg-bot/src/data/themes_ru.json
‚Ä¢ 10 —Ç–µ–º, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∫–Ω–æ–ø–∫–∞–º–∏ 5+5 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
2.2. –ö–∞—Ä–∫–∞—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±–æ—Ç–∞ ‚úÖ ACCEPTED
–ü—É—Ç–∏ (–ø—Ä–∏–º–µ—Ä):
‚Ä¢ /srv/git/skazka/apps/tg-bot/src/bot_app.py
‚Ä¢ /srv/git/skazka/apps/tg-bot/src/handlers/
‚Ä¢ /srv/git/skazka/apps/tg-bot/src/keyboards/
‚Ä¢ /srv/git/skazka/apps/tg-bot/src/messages/ 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
2.3. –ö–æ–º–∞–Ω–¥—ã –∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏ üü° PARTIAL
‚Ä¢  /start ‚Üí –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ ‚Üí –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é L1 ‚Üí ‚Äú‚ñ∂ –ù–∞—á–∞—Ç—å —Å–∫–∞–∑–∫—É‚Äù ‚Üí –≤—ã–±–æ—Ä —Ç–µ–º—ã L2 ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
‚Ä¢  /new ‚Üí —Å—Ç–∞—Ä—Ç –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏ (–ø–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∞) ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
‚Ä¢  /why ‚Üí üß† –ü–æ—á–µ–º—É—á–∫–∞ (–±—ã—Å—Ç—Ä—ã–π Q&A —Ä–µ–∂–∏–º) ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
‚Ä¢  /resume ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚Äî ‚è≥
‚Ä¢  /help ‚Üí —Å–ø—Ä–∞–≤–∫–∞ ‚Äî ‚è≥
‚Ä¢  /status ‚Üí step, active/finished ‚Äî ‚è≥
‚Ä¢  /shop ‚Üí –∑–∞–≥–ª—É—à–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞ (–±–µ–∑ TON) ‚Äî ‚è≥
TG.2.1.04 ‚Äî ‚Äúüß† –ü–æ—á–µ–º—É—á–∫–∞‚Äù (–±—ã—Å—Ç—Ä—ã–π Q&A —Ä–µ–∂–∏–º) ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
‚Ä¢	L1: –∫–Ω–æ–ø–∫–∞ ‚Äúüß† –ü–æ—á–µ–º—É—á–∫–∞‚Äù —Ä—è–¥–æ–º —Å ‚Äú‚ñ∂ –ù–∞—á–∞—Ç—å —Å–∫–∞–∑–∫—É‚Äù
‚Ä¢	–°–æ—Å—Ç–æ—è–Ω–∏–µ: WHY_TEXT (L5.WHY_TEXT), –ª—é–±–æ–π —Ç–µ–∫—Å—Ç = –≤–æ–ø—Ä–æ—Å
‚Ä¢	–û—Ç–≤–µ—Ç: –ª–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ why_qa.json + –º–∞—Ç—á–∏–Ω–≥ keywords/contains + fallback —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
‚Ä¢	UX: –ø—Ä–∏ –≤—Ö–æ–¥–µ —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è ReplyKeyboard L1; –≤ —Ä–µ–∂–∏–º–µ –µ—Å—Ç—å inline ‚Äú‚¨Ö –ù–∞–∑–∞–¥‚Äù (go:l1)
‚Ä¢	–ù–µ –ª–æ–º–∞–µ—Ç —Å–∫–∞–∑–∫—É: ACTIVE-—Å–µ—Å—Å–∏—è –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è


100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
2.4. –õ–æ–≥–∏–∫–∞ ‚Äú—Ö–æ–¥–∞‚Äù –Ω–∞ –∑–∞–≥–ª—É—à–∫–∞—Ö ‚è≥ BACKLOG
‚Ä¢ –Ω–∞ –∫–∞–∂–¥–æ–º —Ö–æ–¥–µ:
o –∑–∞–≥–ª—É—à–µ—á–Ω–∞—è —Å—Ü–µ–Ω–∞
o 3 –∫–Ω–æ–ø–∫–∏
o ‚Äú—Å–≤–æ–π –æ—Ç–≤–µ—Ç‚Äù —Ç–µ–∫—Å—Ç–æ–º
‚Ä¢ –ª–∏–º–∏—Ç 10‚Äì12 —à–∞–≥–æ–≤ ‚Üí –∑–∞–≥–ª—É—à–µ—á–Ω—ã–π —Ñ–∏–Ω–∞–ª 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
2.5. –§–∏–∫—Å–∞—Ü–∏—è —Ñ–∞–∫—Ç–∞ ‚úÖ ACCEPTED
‚Ä¢ /srv/git/skazka/reports/TG_BOT.md 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
DoD —ç—Ç–∞–ø–∞ 1 ‚è≥
‚Ä¢ –±–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ –æ—Ç–≤–µ—á–∞–µ—Ç ‚úÖ
‚Ä¢ —Ç–µ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç (10 –∫–Ω–æ–ø–æ–∫) ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
‚Ä¢ —à–∞–≥–∏ —Ä–∞–±–æ—Ç–∞—é—Ç (3 –∫–Ω–æ–ø–∫–∏ + —Å–≤–æ–π –æ—Ç–≤–µ—Ç) ‚è≥
‚Ä¢ /resume –∏ /status —Ä–∞–±–æ—Ç–∞—é—Ç ‚è≥
‚Ä¢ —Ñ–∏–Ω–∞–ª –Ω–∞—Å—Ç—É–ø–∞–µ—Ç –Ω–∞ –ª–∏–º–∏—Ç–µ ‚è≥ 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
–ü—Ä–æ–≤–µ—Ä–∫–∞ (smoke)
‚Ä¢ /start ‚Üí –≤—ã–±—Ä–∞—Ç—å —Ç–µ–º—É ‚Üí 3 —à–∞–≥–∞ ‚Üí /resume ‚Üí –¥–æ–±–∏—Ç—å –¥–æ —Ñ–∏–Ω–∞–ª–∞ 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
________________________________________
3. –≠—Ç–∞–ø 2: –ë–î (Postgres) + –º–∏–≥—Ä–∞—Ü–∏–∏ + —Å–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ ‚úÖ (–≠–¢–ê–ü –ó–ê–ö–†–´–¢)
–¶–µ–ª—å: —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –ø–ª–∞—Ç–µ–∂–∏ –Ω–µ –≤ –ø–∞–º—è—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞. 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
3.1. –ü–æ–¥–Ω—è—Ç—å Postgres ‚úÖ ACCEPTED
‚Ä¢ docker compose: /srv/git/skazka/infra/docker/
‚Ä¢ —Å–µ–∫—Ä–µ—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: /etc/skazka/skazka.env 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
3.2. –°–Ω–∞—á–∞–ª–∞ —Å—Ö–µ–º–∞ (—Ñ–∏–∫—Å–∏—Ä—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–æ –∫–æ–¥–∞) ‚úÖ ACCEPTED
‚Ä¢ –æ–ø–∏—Å–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã (–º–∏–Ω–∏–º—É–º) –≤ –≤–∏–¥–µ SQL –º–∏–≥—Ä–∞—Ü–∏–∏:
o users
o sessions
o session_events
o payments 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
3.3. –¢–∞–±–ª–∏—Ü—ã (–º–∏–Ω–∏–º—É–º) ‚úÖ ACCEPTED
‚Ä¢ users (tg_id, entitlement, created_at, updated_at)
‚Ä¢ sessions (user_id, status, step, params_json, memory_summary, facts_json, ending_id, created_at, updated_at, expires_at)
‚Ä¢ session_events (session_id, step, user_input, choice_id, llm_json, deltas_json, created_at)
‚Ä¢ payments (user_id, invoice_id, tx_hash, amount, status, created_at, updated_at) 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
3.4. –ú–∏–≥—Ä–∞—Ü–∏–∏ + —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ ‚úÖ ACCEPTED
–ü—É—Ç–∏:
‚Ä¢ /srv/git/skazka/packages/db/migrations/
‚Ä¢ /srv/git/skazka/packages/db/src/
–§—É–Ω–∫—Ü–∏–∏-–º–∏–Ω–∏–º—É–º:
‚Ä¢ users: get_or_create_by_tg_id
‚Ä¢ sessions: get_active / create_new_active / finish
‚Ä¢ events: append_event
‚Ä¢ payments: create_invoice / mark_confirmed / list_pending 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
3.5. –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ TG-–±–æ—Ç –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏ –≤ Postgres ‚úÖ ACCEPTED
‚Ä¢ 1 –∞–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Å—Å–∏—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
3.6. –§–∏–∫—Å–∞—Ü–∏—è —Ñ–∞–∫—Ç–∞ ‚úÖ ACCEPTED
‚Ä¢ /srv/git/skazka/reports/OPS_DB_TON.md 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
DoD —ç—Ç–∞–ø–∞ 2 ‚è≥
‚Ä¢ –∞–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Å—Å–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î
‚Ä¢ /resume –¥–æ—Å—Ç–∞—ë—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ –ë–î
‚Ä¢ —Å–æ–±—ã—Ç–∏—è —à–∞–≥–æ–≤ –ø–∏—à—É—Ç—Å—è –≤ session_events 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
________________________________________
4. –≠—Ç–∞–ø 3: –î–≤–∏–∂–æ–∫ (engine) ‚Äú—Ç—É–ø–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞‚Äù + 5 —Ñ–∏–Ω–∞–ª–æ–≤ ‚è≥
(–∫–∞–∫ —É —Ç–µ–±—è, –±–µ–∑ –ª–∏—à–Ω–µ–π –º–∏—Å—Ç–∏–∫–∏) 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
4.1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å packages/engine ‚úÖ DONE (TG.4.1.01+TG.4.1.02)
–ü—É—Ç–∏:
‚Ä¢ /srv/git/skazka/packages/engine/src/
–§—É–Ω–∫—Ü–∏–∏:
‚Ä¢ SessionState (step, params, memory_summary, facts, ending_id, status)
‚Ä¢ –∫–ª–∞–º–ø—ã: delta -2..+2, –∏—Ç–æ–≥ -10..+10
‚Ä¢ –ª–∏–º–∏—Ç —à–∞–≥–æ–≤: 10‚Äì12
‚Ä¢ –≤—ã–±–æ—Ä —Ñ–∏–Ω–∞–ª–∞: 1 –∏–∑ 5 (–ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º) 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
4.2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ë–î ‚è≥
‚Ä¢ apply_deltas ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å sessions.params_json
‚Ä¢ —Ñ–∏–Ω–∞–ª: sessions.status=finished, sessions.ending_id 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
4.3. –§–∏–∫—Å–∞—Ü–∏—è —Ñ–∞–∫—Ç–∞ ‚úÖ DONE
‚Ä¢ /srv/git/skazka/reports/ENGINE.md 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
DoD —ç—Ç–∞–ø–∞ 3 ‚è≥
‚Ä¢ –º–æ–∂–Ω–æ –ø—Ä–æ–≥–Ω–∞—Ç—å 10‚Äì12 —Ö–æ–¥–æ–≤ –±–µ–∑ LLM, –ø–µ—Ä–µ–¥–∞–≤–∞—è deltas –≤—Ä—É—á–Ω—É—é
‚Ä¢ —Ñ–∏–Ω–∞–ª –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω–æ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
________________________________________
5. –≠—Ç–∞–ø 4: LLM (–∫–æ–Ω—Ç—Ä–∞–∫—Ç JSON, –ø—Ä–æ–º–ø—Ç—ã, –≤–∞–ª–∏–¥–∞—Ç–æ—Ä, —Ä–µ—Ç—Ä–∞–∏) ‚è≥
–¶–µ–ª—å: JSON-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –ø–µ—Ä–≤–∏—á–µ–Ω. 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
5.1. –°–Ω–∞—á–∞–ª–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è JSON-—Å—Ö–µ–º–∞ –¥–æ –∫–æ–¥–∞) ‚è≥
‚Ä¢ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å ‚Äú–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –æ—Ç–≤–µ—Ç–∞‚Äù (—Ö–æ—Ç—è –±—ã —Ç–µ–∫—Å—Ç–æ–º –≤ README –ø–∞–∫–µ—Ç–∞ llm) 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
5.2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å packages/llm ‚è≥
–ü—É—Ç–∏:
‚Ä¢ /srv/git/skazka/packages/llm/src/
‚Ä¢ /srv/git/skazka/packages/llm/prompt_templates/
–§—É–Ω–∫—Ü–∏–∏:
‚Ä¢ —Å–±–æ—Ä–∫–∞ request (seed + session_state + user_input)
‚Ä¢ –≤—ã–∑–æ–≤ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
‚Ä¢ –≤–∞–ª–∏–¥–∞—Ü–∏—è JSON-–æ—Ç–≤–µ—Ç–∞
‚Ä¢ —Ä–µ—Ç—Ä–∞–π 1 —Ä–∞–∑ ‚Äú–≤–µ—Ä–Ω–∏ –≤–∞–ª–∏–¥–Ω—ã–π JSON‚Äù
‚Ä¢ fallback –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —à–∞–≥–∞ 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
5.3. –§–∏–∫—Å–∞—Ü–∏—è —Ñ–∞–∫—Ç–∞ ‚è≥
‚Ä¢ /srv/git/skazka/reports/LLM_FILTERS.md 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
DoD —ç—Ç–∞–ø–∞ 4 ‚è≥
‚Ä¢ —Å–µ—Ä–∏—è –∏–∑ 50 –≤—ã–∑–æ–≤–æ–≤ –¥–∞—ë—Ç –≤–∞–ª–∏–¥–Ω—ã–π JSON
‚Ä¢ —Ç–∞–π–º–∞—É—Ç—ã/–æ—à–∏–±–∫–∏ –Ω–µ –≤–∞–ª—è—Ç —Å–µ—Å—Å–∏—é (fallback —Ä–∞–±–æ—Ç–∞–µ—Ç) 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
________________________________________
6. –≠—Ç–∞–ø 5: –§–∏–ª—å—Ç—Ä—ã –∏ –ø—Ä–∞–≤–∏–ª–∞ (A/B/C + rewrite + fallback) ‚è≥
(–∫–∞–∫ —É —Ç–µ–±—è, –Ω–æ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞–±–æ—Ä–∞ –∫–µ–π—Å–æ–≤) 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
6.1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å packages/filters ‚è≥
–ü—É—Ç–∏:
‚Ä¢ /srv/git/skazka/packages/filters/src/
‚Ä¢ /srv/git/skazka/packages/filters/dictionaries/
Pipeline:
‚Ä¢ prefilter
‚Ä¢ postfilter
‚Ä¢ rewrite (–¥–æ 2)
‚Ä¢ fallback safe-scene 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
6.2. –ù–∞–±–æ—Ä ‚Äú–ø–ª–æ—Ö–∏—Ö –≤–≤–æ–¥–æ–≤‚Äù (—Ñ–∏–∫—Å–∏—Ä—É–µ–º –∫–∞–∫ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–µ–π—Å—ã) ‚è≥
‚Ä¢ –∞–≥—Ä–µ—Å—Å–∏—è/–∂–µ—Å—Ç—å/–º–∞—Ç/—Å–µ–∫—Å/—Å–∞–º–æ–ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ ‚Üí –º—è–≥–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
6.3. –§–∏–∫—Å–∞—Ü–∏—è —Ñ–∞–∫—Ç–∞ ‚è≥
‚Ä¢ /srv/git/skazka/reports/LLM_FILTERS.md 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
DoD —ç—Ç–∞–ø–∞ 5 ‚è≥
‚Ä¢ –∑–∞–ø—Ä–µ—â—ë–Ω–Ω–æ–µ –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –Ω–∞—Ä—É–∂—É
‚Ä¢ rewrite –Ω–µ –∑–∞—Ü–∏–∫–ª–∏–≤–∞–µ—Ç—Å—è
‚Ä¢ –∏–≥—Ä–∞ –Ω–µ –ª–æ–º–∞–µ—Ç—Å—è –æ—Ç –ø–ª–æ—Ö–æ–≥–æ –≤–≤–æ–¥–∞ 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
________________________________________
7. –≠—Ç–∞–ø 6: –°–∫–≤–æ–∑–Ω–æ–π —Ü–∏–∫–ª MVP ‚è≥
(–∫–∞–∫ —É —Ç–µ–±—è, –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ª–æ–π) 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
7.1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å ‚Äú–æ–¥–∏–Ω —à–∞–≥‚Äù –∫–∞–∫ –ø–∞–π–ø–ª–∞–π–Ω ‚è≥
1.	load active session
2.	prefilter(user_input)
3.	llm.generate(request)
4.	validate JSON
5.	postfilter/rewrite
6.	engine.apply(deltas)
7.	save session
8.	append session_event
9.	return narration + 3 choices 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
7.2. –§–∏–Ω–∞–ª ‚è≥
‚Ä¢ –Ω–∞ –ª–∏–º–∏—Ç–µ —à–∞–≥–æ–≤: engine –≤—ã–±–∏—Ä–∞–µ—Ç ending ‚Üí —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç ‚Üí –∑–∞–∫—Ä—ã—Ç—å —Å–µ—Å—Å–∏—é 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
7.3. –§–∏–∫—Å–∞—Ü–∏—è —Ñ–∞–∫—Ç–∞ ‚è≥
‚Ä¢ /srv/git/skazka/reports/TG_BOT.md + /srv/git/skazka/reports/ENGINE.md 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
DoD —ç—Ç–∞–ø–∞ 6 ‚è≥
‚Ä¢ –∏—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç: —Ç–µ–º–∞ ‚Üí —à–∞–≥–∏ ‚Üí —Ñ–∏–Ω–∞–ª
‚Ä¢ /resume –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
‚Ä¢ —Å–æ–±—ã—Ç–∏—è –∏ —Ñ–∏–Ω–∞–ª –ø–∏—à—É—Ç—Å—è –≤ –ë–î 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
________________________________________
8. –≠—Ç–∞–ø 7: TON –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–∞—Ä–∫–∞—Å) ‚è≥
(–æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å, –Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º pending-job –∫–∞–∫ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
8.1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å packages/payments-ton ‚è≥
–ü—É—Ç–∏:
‚Ä¢ /srv/git/skazka/packages/payments-ton/src/
–§—É–Ω–∫—Ü–∏–∏:
‚Ä¢ —Å–æ–∑–¥–∞—Ç—å invoice (record payments)
‚Ä¢ worker/job: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—ã (pending ‚Üí confirmed)
‚Ä¢ –∑–∞–ø–∏—Å–∞—Ç—å tx_hash –∏ —Å—Ç–∞—Ç—É—Å
‚Ä¢ –≤—ã–¥–∞—Ç—å entitlement premium 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
8.2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å –≤ –±–æ—Ç–µ ‚è≥
‚Ä¢ /shop –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è/–∏–Ω–≤–æ–π—Å
‚Ä¢ gate: –¥–æ—Å—Ç—É–ø –ø–æ entitlement 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
8.3. –§–∏–∫—Å–∞—Ü–∏—è —Ñ–∞–∫—Ç–∞ ‚è≥
‚Ä¢ /srv/git/skazka/reports/OPS_DB_TON.md 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
DoD —ç—Ç–∞–ø–∞ 7 ‚è≥
‚Ä¢ –æ–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è –∏ –º–µ–Ω—è–µ—Ç entitlement
‚Ä¢ –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –Ω–µ –∑–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
________________________________________
9. –≠—Ç–∞–ø 8: –≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è (–¥–µ–ø–ª–æ–π, –ª–æ–≥–∏, –±—ç–∫–∞–ø—ã, —á–∏—Å—Ç–∫–∞ 30 –¥–Ω–µ–π) ‚è≥
–¶–µ–ª—å: —Å–µ—Ä–≤–∏—Å –∂–∏–≤—ë—Ç –ø–æ—Å–ª–µ —Ä–µ–±—É—Ç–∞ –∏ –Ω–µ –∑–∞—Å–∏—Ä–∞–µ—Ç –¥–∏—Å–∫. 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
9.1. –ó–∞–ø—É—Å–∫ ‚è≥
‚Ä¢ docker compose –∏–ª–∏ systemd (–≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–æ–≤–µ—Å—Ç–∏ –¥–æ —Ä–∞–±–æ—á–µ–≥–æ) 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
9.2. –õ–æ–≥–∏ ‚è≥
‚Ä¢ –ø–∏—Å–∞—Ç—å –ª–æ–≥–∏ –≤ /var/log/skazka/
‚Ä¢ –≤–∫–ª—é—á–∏—Ç—å —Ä–æ—Ç–∞—Ü–∏—é (logrotate –∏–ª–∏ docker –Ω–∞—Å—Ç—Ä–æ–π–∫–∏) 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
9.3. –ë—ç–∫–∞–ø—ã –ë–î ‚è≥
‚Ä¢ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –¥–∞–º–ø –≤ /var/backups/skazka/postgres/daily/
‚Ä¢ —Å–∫—Ä–∏–ø—Ç—ã:
o /srv/git/skazka/scripts/backup_db.sh
o /srv/git/skazka/scripts/restore_db.sh 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
9.4. –û—á–∏—Å—Ç–∫–∞ 30 –¥–Ω–µ–π ‚è≥
‚Ä¢ job —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö sessions/session_events/payments –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
9.5. –§–∏–∫—Å–∞—Ü–∏—è —Ñ–∞–∫—Ç–∞ ‚è≥
‚Ä¢ /srv/git/skazka/reports/OPS_DB_TON.md 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
DoD —ç—Ç–∞–ø–∞ 8 ‚è≥
‚Ä¢ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚Ä¢ –±—ç–∫–∞–ø —Å–æ–∑–¥–∞—ë—Ç—Å—è
‚Ä¢ —á–∏—Å—Ç–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
‚Ä¢ –ª–æ–≥–∏ —á–∏—Ç–∞–µ–º—ã–µ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –ø–æ —Ä–∞–∑–º–µ—Ä—É 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
________________________________________
10. –≠—Ç–∞–ø 9: –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è v0.1 (QA) ‚è≥
–¶–µ–ª—å: MVP –Ω–µ —Ä–∞–∑–≤–∞–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö. 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
10.1. –ü—Ä–æ–≥–æ–Ω—ã –ø–æ —Ç–µ–º–∞–º: –º–∏–Ω–∏–º—É–º 2 –∏—Å—Ç–æ—Ä–∏–∏ –Ω–∞ –∫–∞–∂–¥—É—é —Ç–µ–º—É ‚è≥
10.2. –°–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–æ–∫ JSON (–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Å—Ö–µ–º—ã, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—É—Å—Ç—ã—Ö –ø–æ–ª–µ–π) ‚è≥
10.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –Ω–∞ ‚Äú–ø–ª–æ—Ö–∏—Ö –≤–≤–æ–¥–∞—Ö‚Äù ‚è≥
10.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è /resume ‚è≥
10.5. –ü—Ä–æ–≤–µ—Ä–∫–∞ ‚Äú–æ–¥–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Å—Å–∏—è‚Äù ‚è≥
10.6. –§–∏–Ω–∞–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å –∏—Ç–æ–≥–æ–≤ –≤ reports/IMPLEMENTATION_INDEX.md ‚è≥ 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
DoD —ç—Ç–∞–ø–∞ 9 ‚è≥
‚Ä¢ MVP —Å—Ç–∞–±–∏–ª–µ–Ω: –Ω–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–∞–¥–µ–Ω–∏–π, —Ñ–∏–Ω–∞–ª –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è, –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–æ–±–ª—é–¥–∞—é—Ç—Å—è 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
________________________________________
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ A: –ò–Ω–¥–µ–∫—Å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ ‚úÖ
‚Ä¢ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: /srv/git/skazka/
‚Ä¢ –ë—ç–∫–∞–ø—ã –ø—Ä–∞–≤–æ–∫: /srv/git/skazka/backups/
‚Ä¢ –ñ—É—Ä–Ω–∞–ª —Ñ–∞–∫—Ç–∞: /srv/git/skazka/reports/‚Ä¶
‚Ä¢ –°–µ–∫—Ä–µ—Ç—ã: /etc/skazka/skazka.env
‚Ä¢ –õ–æ–≥–∏: /var/log/skazka/
‚Ä¢ –ë—ç–∫–∞–ø—ã –ë–î: /var/backups/skazka/postgres/ 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
________________________________________
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ B: Dev-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (–¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞) ‚è≥
(–≠—Ç–æ –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç –ø—É–Ω–∫—Ç—ã –ø–ª–∞–Ω–∞, —ç—Ç–æ –Ω–∞–¥—Å—Ç—Ä–æ–π–∫–∞ ‚Äú—á—Ç–æ–±—ã –ø–∏–∑–∂–µ —Ä–∞–±–æ—Ç–∞—Ç—å‚Äù, –∫–∞–∫ —Ç—ã –∏ —Ö–æ—Ç–µ–ª.)
‚Ä¢	B.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ VS Code (Remote SSH) ‚è≥
‚Ä¢	B.2 –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —ç—Ç–æ–≥–æ —á–∞—Ç–∞ –∫ GitHub-–∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä—É ‚è≥
‚Ä¢	B.3 –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Codex (—á—Ç–æ–±—ã –∫–æ–¥-—Ä–µ–≤—å—é/—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —à—ë–ª –±—ã—Å—Ç—Ä–µ–µ) ‚è≥
‚Ä¢	B.4 –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π CI: lint + typecheck + tests ‚è≥
‚Ä¢	B.5 Pre-commit / secret scanning (–∑–∞—â–∏—Ç–∞ –æ—Ç ‚Äú–æ–π —Ç–æ–∫–µ–Ω —É—Ç—ë–∫‚Äù) ‚è≥
________________________________________
–°–≤–µ—Ä–∫–∞ ‚Äú–Ω–µ —Å–±–∏–ª–∏—Å—å –ª–∏ —Å –ø—É—Ç–∏‚Äù
–ù–µ —Å–±–∏–ª–∏—Å—å. –≠—Ç–∞–ø 0 –∑–∞–∫—Ä—ã—Ç. –°–µ–π—á–∞—Å —Å–ª–µ–¥—É—é—â–∏–π —Ä–µ–∞–ª—å–Ω—ã–π —É–∑–∫–∏–π –≥–æ—Ä–ª—ã—à–∫–æ: 2.1 (—Ç–µ–º—ã –∫–∞–∫ –¥–∞–Ω–Ω—ã–µ), –∏–Ω–∞—á–µ –±–æ—Ç –æ—Å—Ç–∞–Ω–µ—Ç—Å—è ‚Äú–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º, –∫–æ—Ç–æ—Ä—ã–π —É–º–µ–µ—Ç /start‚Äù, –∞ –Ω–µ –ø—Ä–æ–¥—É–∫—Ç–æ–º. 
100_–ü–ª–∞–Ω_—Ä–∞–±–æ—Ç
________________________________________
–ü—Ä–∞–≤–∏–ª–æ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏
–ü—Ä–∏–Ω—è—Ç–æ: –∫–∞–∂–¥—ã–µ 12 —Å–æ–æ–±—â–µ–Ω–∏–π –º—ã –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ–º/–∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä—É–µ–º —ç—Ç–æ—Ç –ø–ª–∞–Ω –∏ —Å—Ç–∞—Ç—É—Å—ã.
–°—á—ë—Ç—á–∏–∫: 0/12 (—è —Ç–æ–ª—å–∫–æ —á—Ç–æ –ø–µ—Ä–µ–ø–∏—Å–∞–ª, —Ç–∞–∫ —á—Ç–æ —Å–±—Ä–æ—Å).
============================================================
–ü–†–ò–õ–û–ñ–ï–ù–ò–ï P. –ö–æ–Ω—Ç–µ–Ω—Ç-—Ä–µ–µ—Å—Ç—Ä—ã —Ç–µ–º/—Å—Ç–∏–ª–µ–π –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (v0.1)
============================================================

–¶–µ–ª—å:
- –∑–∞–∫—Ä–µ–ø–∏—Ç—å 12 —Ç–µ–º –¥–ª—è L2
- –∑–∞–∫—Ä–µ–ø–∏—Ç—å style_id (–º–∞–Ω–µ—Ä–∞ —Ç–µ–∫—Å—Ç–∞) –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä –º–æ–¥–µ–ª–∏
- –∑–∞–∫—Ä–µ–ø–∏—Ç—å —Å–ª–æ–≤–∞—Ä—å —Ç–µ–≥–æ–≤
- –∑–∞–∫—Ä–µ–ø–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Ñ–æ—Ä–º–∞—Ç–∞ "3 –∞–±–∑–∞—Ü–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è + 1 –≤—ã–±–æ—Ä"

–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã (–≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏):
- content/themes.yaml
- content/styles.yaml
- content/tag_vocab.yaml
- docs/GEN_CONTRACT.md
- docs/THEMES_STYLES.md (–æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ö–µ–º—ã —Ä–µ–µ—Å—Ç—Ä–æ–≤)

DoD:
- –∫–∞–∂–¥–∞—è —Ç–µ–º–∞ –∏–º–µ–µ—Ç: id/title/subtitle/tags/style_default/style_tag + —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π starter_brief
- tags –±–µ—Ä—É—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ tag_vocab.yaml
- style_id –≤–ª–∏—è–µ—Ç –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å—Ç–∞–±–∏–ª—å–Ω–æ
- –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Å–µ–≥–¥–∞ —Å–æ–±–ª—é–¥–∞–µ—Ç: 3 –∞–±–∑–∞—Ü–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è ‚Üí 1 –≤—ã–±–æ—Ä (–ê/–ë/–í + —Å–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç)
- –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω MVP –µ–¥–∏–Ω—ã–π: 4‚Äì10 (–±–µ–∑ —Ä–µ–∂–∏–º–æ–≤)

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:
- DOCX –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç YAML-–¥–∞–Ω–Ω—ã–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é; DOCX –æ–ø–∏—Å—ã–≤–∞—é—Ç –ø—Ä–∞–≤–∏–ª–∞ –∏ UX.
- YAML/MD –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã.


–ü–ê–¢–ß –ü–û –†–ï–ê–õ–ò–ó–ê–¶–ò–ò –î–í–ò–ñ–ö–ê
–ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò ENGINE v0.1 (ENG.4.1.01 REV3)
0) –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏—Å—Ç–∏–Ω—ã (–Ω–µ –æ–±—Å—É–∂–¥–∞–µ—Ç—Å—è)
‚Ä¢	docs/ENGINE_SPEC_v0_1.md (–∫–∞–Ω–æ–Ω –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏/–ø—Ä–∞–≤–∏–ª)
‚Ä¢	ENG.4.1.01 ‚Äî ACCEPTED SPEC (REV3) (–∫–∞–Ω–æ–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞–∫ pure library)
________________________________________
1) –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–∫–µ—Ç–∞
–¶–µ–ª—å: engine –∫–∞–∫ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞, –±–µ–∑ TG/–ë–î.
–ü–∞–ø–∫–∏/—Ñ–∞–π–ª—ã:
‚Ä¢	packages/engine/src/models.py
‚Ä¢	packages/engine/src/engine_v0_1.py
‚Ä¢	packages/engine/tests/test_engine_v0_1.py
‚Ä¢	(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) packages/engine/README.md (–∫–∞–∫ –ø–æ–¥–∫–ª—é—á–∞—Ç—å/—á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç)
________________________________________
2) –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (JSON-serializable)
–§–∞–π–ª: packages/engine/src/models.py
2.1 Enum-–ø–æ–ª—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∏ (–Ω–∏–∫–∞–∫–∏—Ö Python Enum –≤ state/log)
–°–¥–µ–ª–∞—Ç—å —Å—Ç—Ä–æ–∫–∏ –ø–æ –∫–∞–Ω–æ–Ω—É:
‚Ä¢	step_type: "NORMAL"|"SEMI"|"HEAVY"
‚Ä¢	turn.kind: "choice"|"free_text"
‚Ä¢	MilestoneVote.vote: "t1".."t5"|"none"
‚Ä¢	MilestoneVote.reason: "content"|"intent"|"none"
‚Ä¢	neutral_reason: low_confidence|parse_fail|safety_unclear|missing_mapping|noise_input
‚Ä¢	final_id: "F1".."F5"
‚Ä¢	f5_reason: chaos_dominant|noise_abort
‚Ä¢	f4_tone: growth|success
‚Ä¢	leader_core: "t1".."t5"|"tie"
2.2 Dataclass‚Äô—ã/TypedDict‚Äô–∏ —Ç–æ–ª—å–∫–æ —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏
–°—É—â–Ω–æ—Å—Ç–∏:
‚Ä¢	EngineStateV01
‚Ä¢	Turn
‚Ä¢	ContentStep
‚Ä¢	Choice
‚Ä¢	Delta
‚Ä¢	MilestoneVote
‚Ä¢	StepLogV01
‚Ä¢	FinalMetaV01
________________________________________
3) –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å milestones_for_N(n)
–§–∞–π–ª: packages/engine/src/engine_v0_1.py
3.1 –§–æ—Ä–º—É–ª—ã v0.1
‚Ä¢	M2_step0 = 2 (–ø–æ—Ç–æ–º—É —á—Ç–æ UI=3)
‚Ä¢	M6_step0 = round(0.65*(N-1)) (–≤ step0)
‚Ä¢	M7_step0 = round(0.80*(N-1))
‚Ä¢	–ö–æ–ª–ª–∏–∑–∏—è: –µ—Å–ª–∏ M6_step0 == M7_step0 ‚Üí M7_step0 = min(N-1, M7_step0 + 1)
3.2 –í–µ—Ä–Ω—É—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
{"m2": int, "m6": int, "m7": int}
________________________________________
4) –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É—Ç–∏–ª–∏—Ç—ã engine (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ)
–§–∞–π–ª: engine_v0_1.py
4.1 is_noise(text) –ø–æ –∫–∞–Ω–æ–Ω—É
–ü—Ä–∞–≤–∏–ª–∞ (–∫–∞–∫ –≤ ENGINE_SPEC):
‚Ä¢	len(trim)<3 ‚Üí noise
‚Ä¢	^[\s.\‚Ä¶]+$ ‚Üí noise
‚Ä¢	—Å–ø–∏—Å–æ–∫ –ø–∞—Ä–∞–∑–∏—Ç–æ–≤ ("–Ω–µ –∑–Ω–∞—é","—Ö–∑","..." –∏ —Ç.–ø.) ‚Üí noise
4.2 Clamp traits 0..10
traits[k] = min(10, max(0, traits[k]))
4.3 –í–∞–ª–∏–¥–∞—Ü–∏—è/–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è deltas
‚Ä¢	len<=2
‚Ä¢	abs(v)<=2
‚Ä¢	sum_abs<=limit(step_type) –≥–¥–µ 2/3/4
‚Ä¢	MVP –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è choice: –∑–∞–ø—Ä–µ—Ç v<0 –ø–æ t1..t5
‚Ä¢	–µ—Å–ª–∏ –Ω–∞—Ä—É—à–µ–Ω–æ ‚Üí —Ä–µ–∑–∞—Ç—å –∏ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ñ–ª–∞–≥–æ–º –≤ StepLog (*_delta_clamped=true)
________________________________________
5) –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å apply_turn(state, turn, content_step)
–§–∞–π–ª: engine_v0_1.py
5.1 –í–Ω—É—Ç—Ä–∏ –≤—ã—á–∏—Å–ª–∏—Ç—å milestone_id
‚Ä¢	–≤—ã–∑–≤–∞—Ç—å milestones_for_N(state.n)
‚Ä¢	milestone_id = "m2"|"m6"|"m7"|None –ø–æ state.step0
5.2 –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å input_mode –∏ neutral
–°—Ü–µ–Ω–∞—Ä–∏–∏:
‚Ä¢	turn.kind="choice" ‚Üí –±–µ—Ä—ë–º Choice –ø–æ turn.choice_id
o	–µ—Å–ª–∏ –Ω–µ—Ç choice/mapping ‚Üí neutral_reason="missing_mapping", deltas=[]
‚Ä¢	turn.kind="free_text" ‚Üí –≤ MVP –±–µ–∑ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞
o	–µ—Å–ª–∏ noise ‚Üí neutral_reason="noise_input"
o	–∏–Ω–∞—á–µ ‚Üí neutral_reason="parse_fail"
o	deltas=[]
‚Ä¢	noise_streak:
o	–µ—Å–ª–∏ free_text –∏ noise ‚Üí +1
o	–∏–Ω–∞—á–µ –µ—Å–ª–∏ –Ω–µ —à—É–º ‚Üí 0 (–ø–æ–¥—Ä—è–¥)
5.3 Free-text gating
‚Ä¢	free_text_allowed_after = (noise_streak < 3)
5.4 F5 noise_abort –¥–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —à–∞–≥–∞
‚Ä¢	–µ—Å–ª–∏ noise_streak >= 5:
o	—Ñ–∏–Ω–∞–ª —Å—Ä–∞–∑—É F5
o	final_meta.f5_reason = noise_abort
o	rule_hit=0
5.5 –ü—Ä–∏–º–µ–Ω–∏—Ç—å deltas (–µ—Å–ª–∏ –Ω–µ neutral –∏ –Ω–µ —Ñ–∏–Ω–∞–ª)
‚Ä¢	–≤–∑—è—Ç—å deltas –∏–∑ choice
‚Ä¢	–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ –ª–∏–º–∏—Ç–∞–º
‚Ä¢	–ø—Ä–∏–º–µ–Ω–∏—Ç—å –≤ traits
‚Ä¢	clamp 0..10
5.6 Milestone votes (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ milestone –∏ –µ—Å—Ç—å –≤–∞–ª–∏–¥–Ω—ã–π vote)
‚Ä¢	–µ—Å–ª–∏ milestone –∏ —Ö–æ–¥ –≤–∞–ª–∏–¥–Ω—ã–π (–Ω–µ neutral/missing_mapping/noise):
o	–ø—Ä–∏–º–µ–Ω–∏—Ç—å choice.milestone_vote –≤ state.milestone_votes[milestone_id]
‚Ä¢	–µ—Å–ª–∏ milestone –∏ —Ö–æ–¥ neutral:
o	state –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å
o	–≤ StepLog:
ÔÇß	milestone_vote_current={none,none}
ÔÇß	milestone_vote_missing=[milestone_id]
5.7 –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç —à–∞–≥–∞
‚Ä¢	–µ—Å–ª–∏ —Ñ–∏–Ω–∞–ª –Ω–µ –≤—ã–±—Ä–∞–Ω ‚Üí step0 += 1
‚Ä¢	–µ—Å–ª–∏ —Ñ–∏–Ω–∞–ª –≤—ã–±—Ä–∞–Ω ‚Üí step0 –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
5.8 –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–ª –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º —à–∞–≥–µ
‚Ä¢	–µ—Å–ª–∏ old_step0 == n-1 –∏ —Ñ–∏–Ω–∞–ª–∞ –µ—â—ë –Ω–µ—Ç ‚Üí –≤—ã–∑–≤–∞—Ç—å pick_final(new_state) –∏ –≤–µ—Ä–Ω—É—Ç—å —Ñ–∏–Ω–∞–ª
________________________________________
6) –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å pick_final(state) -> (final_id, final_meta)
–§–∞–π–ª: engine_v0_1.py
6.1 –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å Core –º–µ—Ç—Ä–∏–∫–∏
‚Ä¢	Core = t1..t5
‚Ä¢	max_core, min_core
‚Ä¢	top1/top2, gap_core
‚Ä¢	leader_core –∏–ª–∏ "tie"
6.2 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ (Rule 0..4)
–í —Ç–æ—á–Ω–æ—Å—Ç–∏ –ø–æ ENGINE_SPEC:
‚Ä¢	Rule0: noise_abort —É–∂–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω —Ä–∞–Ω—å—à–µ, –Ω–æ pick_final –¥–æ–ª–∂–µ–Ω —Ç–æ–∂–µ —É–º–µ—Ç—å
‚Ä¢	Rule1: chaos_dominant: t6>=9 AND max_core<=8 ‚Üí F5 + meta.f5_reason
‚Ä¢	Rule2: max_core>=9 AND gap_core>=2 AND leader unique ‚Üí F1/F2/F3 mapping
‚Ä¢	Rule3: max_core>=9 AND (gap<2 OR tie) ‚Üí tie-break –ø–æ milestone_votes ‚Üí –ª–∏–±–æ F1/F2/F3, –ª–∏–±–æ F4
‚Ä¢	Rule4: –∏–Ω–∞—á–µ F4
6.3 F4 tone
‚Ä¢	min_core <= 3 ‚Üí growth
‚Ä¢	–∏–Ω–∞—á–µ success
6.4 final_meta –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
–ó–∞–ø–æ–ª–Ω–∏—Ç—å:
‚Ä¢	rule_hit
‚Ä¢	max_core/min_core/gap_core/leader_core
‚Ä¢	tie_break_used
‚Ä¢	tie_break_votes
‚Ä¢	f5_reason –∏–ª–∏ f4_tone –ø–æ —Ñ–∏–Ω–∞–ª—É
________________________________________
7) –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å StepLogV01 (—Å—Ç—Ä–æ–≥–æ)
–§–∞–π–ª: engine_v0_1.py (—Å–±–æ—Ä–∫–∞ –ª–æ–≥–∞), –º–æ–¥–µ–ª—å –≤ models.py
–õ–æ–≥ –¥–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å –º–∏–Ω–∏–º—É–º:
‚Ä¢	–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã: v,n,step0,step_type
‚Ä¢	–≤—Ö–æ–¥: turn_kind, choice_id, user_input_present
‚Ä¢	noise: noise_input, noise_streak_before/after, free_text_allowed_after
‚Ä¢	neutral: neutral_reason|null
‚Ä¢	deltas: applied_deltas
‚Ä¢	traits: traits_before/after
‚Ä¢	milestone: milestone_id, milestone_vote_current, milestone_vote_missing
‚Ä¢	—Ñ–∏–Ω–∞–ª: final_id|null, final_meta|null
‚Ä¢	—Ñ–ª–∞–≥–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏: content_delta_clamped, classifier_delta_clamped (—Ö–æ—Ç—è classifier –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)
________________________________________
8) –¢–µ—Å—Ç—ã (DoD, –±–µ–∑ –∂–∞–ª–æ—Å—Ç–∏)
–§–∞–π–ª: packages/engine/tests/test_engine_v0_1.py
–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞–±–æ—Ä—ã:
8.1 milestones_for_N
‚Ä¢	N=8/10/12 –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ step0
‚Ä¢	–∫–æ–ª–ª–∏–∑–∏—è ‚Üí m7 —Å–¥–≤–∏–≥–∞–µ—Ç—Å—è
8.2 apply_turn step increment
‚Ä¢	–±–µ–∑ —Ñ–∏–Ω–∞–ª–∞ step0 +1
‚Ä¢	—Å —Ä–∞–Ω–Ω–∏–º —Ñ–∏–Ω–∞–ª–æ–º step0 –Ω–µ —Ä–∞—Å—Ç—ë—Ç
8.3 Noise gating –∏ F5
‚Ä¢	3 –ø–æ–¥—Ä—è–¥ noise ‚Üí free_text_allowed_after=false
‚Ä¢	5 –ø–æ–¥—Ä—è–¥ noise ‚Üí —Ñ–∏–Ω–∞–ª F5 + f5_reason=noise_abort
8.4 Missing mapping
‚Ä¢	–Ω–µ–≤–µ—Ä–Ω—ã–π choice_id/–Ω–µ—Ç choice ‚Üí neutral_reason=missing_mapping, deltas –ø—É—Å—Ç—ã–µ
8.5 Milestone missing semantics
‚Ä¢	–Ω–∞ milestone –ø—Ä–∏ neutral ‚Üí state.milestone_votes –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
‚Ä¢	StepLog –ø–∏—à–µ—Ç current none + missing=[milestone_id]
8.6 Final rules coverage
‚Ä¢	Rule1 chaos_dominant
‚Ä¢	Rule2 –¥–æ–º–∏–Ω–∞–Ω—Ç–∞
‚Ä¢	Rule3 tie-break –ø–æ–±–µ–¥–∏—Ç–µ–ª—å –∏ tie-break fallback –≤ F4
‚Ä¢	Rule4 F4
8.7 –î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º
‚Ä¢	–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –≤—Ö–æ–¥—ã ‚Üí –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –≤—ã—Ö–æ–¥—ã (state/log/final_meta)
________________________________________
9) –ú–∏–Ω–∏-–≤—ã—Ö–æ–¥–Ω–æ–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç: –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (—á—Ç–æ–±—ã –Ω–µ –≥–∞–¥–∞–ª–∏)
–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ –ø–æ–ª–µ–∑–Ω–æ:
‚Ä¢	–≤ packages/engine/README.md –¥–∞—Ç—å 1 –ø—Ä–∏–º–µ—Ä:
o	init state
o	apply_turn 2-3 —Ä–∞–∑–∞
o	–ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É step_log/final_meta
________________________________________
–ß—Ç–æ –ª–∏—à–Ω–µ–µ / —á—Ç–æ –Ω–µ —É—á—Ç–µ–Ω–æ (–ø–æ —Ç–≤–æ–µ–º—É –≤–æ–ø—Ä–æ—Å—É)
–õ–∏—à–Ω–µ–≥–æ –≤ REV3 –ø–æ—á—Ç–∏ –Ω–µ—Ç. –ù–æ –≤ —Ç–≤–æ–∏—Ö —Ä–∞–Ω–Ω–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞—Ö –±—ã–ª–æ –ª–∏—à–Ω–µ–µ:
‚Ä¢	step_ui –≤–Ω—É—Ç—Ä–∏ engine (—É–±—Ä–∞–Ω–æ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ)
‚Ä¢	is_milestone –≤ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ (—É–±—Ä–∞–Ω–æ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ)
‚Ä¢	–æ—Ç–¥–µ–ª—å–Ω—ã–π final_reason (—É–±—Ä–∞–Ω–æ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ)
–ß—Ç–æ –≤–∞–∂–Ω–æ –ù–ï –∑–∞–±—ã—Ç—å (–æ–±—ã—á–Ω–æ –∑–∞–±—ã–≤–∞—é—Ç):
‚Ä¢	step0 vs step_ui –≤–µ–∑–¥–µ –æ–¥–∏–Ω–∞–∫–æ–≤–æ —Ç—Ä–∞–∫—Ç–æ–≤–∞—Ç—å
‚Ä¢	–º–∏–ª—Å—Ç–æ—É–Ω –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ old_step0, –∞ –Ω–µ –ø–æ new_step0
‚Ä¢	–Ω–∞ milestone –ø—Ä–∏ neutral: state –Ω–µ —Ç—Ä–æ–≥–∞–µ–º, –Ω–æ StepLog —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç missing
‚Ä¢	pick_final –æ–±—è–∑–∞–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å meta –≤—Å–µ–≥–¥–∞, –∏–Ω–∞—á–µ –ø–æ—Ç–æ–º –Ω–µ—á–µ–º –æ–±—ä—è—Å–Ω—è—Ç—å
‚Ä¢	–ö–∞–∫ –≤ —á–∏—Å—Ç–æ–≤–∏–∫–µ

